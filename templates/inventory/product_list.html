{% extends 'base.html' %}

{% block title %}Inventory - Digital Khata{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold mb-0">Inventory</h1>
            <p class="text-gray-600 mb-0">Manage your products and stock levels</p>
        </div>
        <a href="{% url 'inventory:product_create' %}" class="btn btn-primary btn-lg d-flex align-items-center">
            <i class="bi bi-plus-circle me-2"></i> Add Product
        </a>
    </div>

    <!-- Search and Filter Section -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-lg-4 col-md-6">
                    <label for="search" class="form-label fw-medium">Search Products</label>
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search text-gray-500"></i>
                        </span>
                        <input type="text" class="form-control border-start-0" id="search" name="search" placeholder="Search by name or SKU" value="{{ search_query }}">
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <label class="form-label fw-medium">&nbsp;</label>
                    <div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search me-1"></i> Search
                        </button>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <label class="form-label fw-medium">&nbsp;</label>
                    <div>
                        <a href="?low_stock=1" class="btn btn-warning w-100 {% if request.GET.low_stock %}active{% endif %}">
                            <i class="bi bi-exclamation-triangle me-1"></i> Low Stock
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <label class="form-label fw-medium">&nbsp;</label>
                    <div>
                        <a href="{% url 'inventory:product_list' %}" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-x-circle me-1"></i> Clear
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Inventory Stats -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-gray-500 mb-1">Total Products</h6>
                            <h3 class="mb-0 fw-bold">{{ products|length }}</h3>
                        </div>
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                            <i class="bi bi-box-seam text-primary fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-gray-500 mb-1">Low Stock Items</h6>
                            <h3 class="mb-0 fw-bold">{{ products|length }}</h3>
                        </div>
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                            <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-gray-500 mb-1">Total Value</h6>
                            <h3 class="mb-0 fw-bold">रू {{ total_inventory_value|floatformat:2 }}</h3>
                        </div>
                        <div class="rounded-circle bg-success bg-opacity-10 p-3">
                            <i class="bi bi-currency-rupee text-success fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-gray-500 mb-1">Out of Stock</h6>
                            <h3 class="mb-0 fw-bold">0</h3>
                        </div>
                        <div class="rounded-circle bg-danger bg-opacity-10 p-3">
                            <i class="bi bi-archive text-danger fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Grid -->
    {% if products %}
    <div class="row g-4" id="products-container">
        {% for product in products %}
        <div class="col-xl-3 col-lg-4 col-md-6 product-card fade-in-up">
            <div class="card border-0 shadow-sm h-100 product-item {% if product.is_low_stock %}border-start border-4 border-warning{% endif %}">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="card-title fw-bold mb-1">{{ product.name }}</h5>
                            <p class="text-gray-500 mb-0 small">SKU: {{ product.sku }}</p>
                        </div>
                        {% if product.is_low_stock %}
                        <span class="badge bg-warning" data-bs-toggle="tooltip" title="Low Stock">
                            <i class="bi bi-exclamation-triangle"></i>
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="mt-auto">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-gray-500">Price</span>
                            <span class="fw-bold">रू {{ product.price|floatformat:2 }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-gray-500">Stock</span>
                            <span class="fw-bold {% if product.is_low_stock %}text-warning{% endif %}">{{ product.quantity }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-gray-500">Tax</span>
                            <span class="fw-bold">{{ product.tax_rate|floatformat:2 }}%</span>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'inventory:product_update' product.pk %}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{% url 'inventory:product_delete' product.pk %}" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    <div class="mt-5 d-flex justify-content-center">
        <nav>
            <ul class="pagination">
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    {% else %}
    <div class="card border-0 shadow-sm">
        <div class="card-body text-center py-6">
            <div class="mb-4">
                <i class="bi bi-box-seam fs-1 text-gray-300"></i>
            </div>
            <h3 class="mb-3">No products found</h3>
            <p class="text-gray-600 mb-4">Get started by adding your first product to your inventory.</p>
            <a href="{% url 'inventory:product_create' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i> Add Your First Product
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- Floating Action Button -->
<div class="position-fixed bottom-0 end-0 me-4 mb-4">
    <a href="{% url 'inventory:product_create' %}" class="btn btn-primary btn-lg rounded-circle shadow-lg" style="width: 60px; height: 60px;">
        <i class="bi bi-plus fs-3"></i>
    </a>
</div>

<!-- Toast Container -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="toast-container"></div>
</div>

<script>
// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Add fade-in animation to product cards
    const productCards = document.querySelectorAll('.product-card');
    productCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
});

// Toast notification function
function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toast-container');
    const toastId = 'toast-' + Date.now();
    
    const toastHTML = `
        <div id="${toastId}" class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
    
    const toast = new bootstrap.Toast(document.getElementById(toastId), {
        delay: 3000
    });
    
    toast.show();
    
    // Remove toast after it's hidden
    document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
        this.remove();
    });
}
</script>
{% endblock %}